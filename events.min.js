~function(t){function n(t,n){if(!t)throw new Error("Event name is required");return function(i){var e=h(this);return"function"==typeof i?e.sub(t,i,n):e.pub(t,new b(this,i))}}var i="HybridEvent",e=i+Date.now(),o="prototype",r="callbacks",s="events",a="currentTarget",u="options",c=function(t){this[s]={},this.ctx=t},h=function(t){return t[e]||(t[e]=new c(t))},f=c[o],l=function(t,n){this[r]=[],this[u]=n||{},this.name=t},p=l[o],d=function(t){return function(){return t}},g=d(!0),v=d(!1),m="isPropagationStopped",w="isImmediatePropagationStopped",b=function(t,n){return n instanceof b?(n[a]=t,n):(this.target=this[a]=t,this.data=n,this[m]=v,void(this[w]=v))},x=b[o];x.stopImmediatePropagation=function(){this[m]=this[w]=g},x.stopPropagation=function(){this[m]=g},p.add=function(t,n){var i=this,e=i[r],o=i[u],s=o.setup,a=o.add,c=i.name,h=e.length;return e.push(t),s&&!h&&s.call(n,c),a&&a.call(n,c),function(){i.remove(t,n)}},p.toggle=function(t,n){return this[~this[r].indexOf(t)?"remove":"add"](t,n)},p.remove=function(t,n){var i=this[r],e=this.name,o=i.indexOf(t),s=this[u],a=s.remove,c=s.teardown;~o&&(i.splice(o,1),a&&a.call(n,e),c&&!i.length&&c.call(n,e))},p.fire=function(t){var n=this[r],i=n.length,e=0,o=this[u].propagate,s=t[a];if(i)for(n=n.slice(0);i>e&&!t[w]();)n[e++].call(s,t);o&&!t[m]()&&(s=o.call(s),s&&s[this.name](t))},f.sub=function(t,n,i){var e=this[s][t];return e||(this[s][t]=e=new l(t,i)),e.toggle(n,this.ctx)},f.pub=function(t,n){this[s][t].fire(n)},t[i]=n}(window);